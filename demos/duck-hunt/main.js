!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{constructor(){this._sprite=null}get sprite(){return this._sprite}toString(){return this.sprite.toString()}},n=class extends s{constructor(t,e,i){super(),this.spritesheet=[],this.spriteIndex=0,this.position=t,this.orientation=e,this.changeState(i)}update(){this.behaviour()}get sprite(){return this.spritesheet[this.spriteIndex]}move(t,e=1){this.orientation=t,this.position=this.predictPosition(t,e)}changeState(t){this.state=t,this.behaviour=()=>{}}predictPosition(t,e=1){return this.position+t*e}},o=function(t,e){return Math.random()*(e-t+1)+t<<0},r=class extends n{constructor(t,e){super(t,e,"idle"),this.spritesheet=["2","S"],this.idleTurns=30}update(){super.update(),this.spriteIndex=1===this.orientation?1:0}changeState(t){switch(super.changeState(t),t){case"idle":this.idleTurnsCount=0,this.behaviour=this.idleBehaviour;break;case"walking":this.behaviour=this.walkBehaviour;break;case"turn":this.behaviour=this.turnBehaviour}}idleBehaviour(){this.idleTurnsCount++,this.idleTurns<=this.idleTurnsCount&&this.changeState(["walking","idle","turn"][o(0,2)])}walkBehaviour(){this.changeState("idle")}turnBehaviour(){this.orientation*=-1,this.changeState("idle")}},a=class extends s{constructor(){super(),this._sprite=".."}},h=class extends n{constructor(t){super(t,0,"normal"),this.spritesheet=["(..)","(2)","(S)","(x)"],this.cooldownTurns=20}changeState(t){switch(super.changeState(t),t){case"normal":this.behaviour=this.normalBehaviour;break;case"cooldown":this.cooldownTurnsCount=0,this.behaviour=this.cooldownBehaviour}}normalBehaviour(){this.spriteIndex=0,this.target&&(this.spriteIndex=this.target.orientation>0?2:1)}cooldownBehaviour(){this.spriteIndex=3,this.cooldownTurnsCount++,this.cooldownTurns<=this.cooldownTurnsCount&&this.changeState("normal")}shoot(){this.changeState("cooldown")}},u={},c={},d=0,l={},p={};function v(t){d++,l.updateDucks(d),c.target=l.locateDuck(c.position),c.update(),u.reset(),l.ducks.forEach(t=>u.addGameObject(t)),u.addGameObject(c),location.hash=u,requestAnimationFrame(v)}function f(t){var e=c.predictPosition(t.direction);e>=0&&e<=100&&c.move(t.direction)}function g(){"cooldown"!==c.state&&(c.shoot(),c.target&&l.killDuck(c.target))}u=new class extends s{constructor(t){super(),this.size=t,this._default=Array.from(Array(this.size),()=>new a),this.reset()}get sprite(){return this.tiles.join("")}reset(){this.tiles=this._default.slice(0)}addGameObject(t){this.tiles[t.position]=t}}(100),c=new h(0),l=new class{constructor(t,e,i){this.numDucks=t,this.mapLength=e,this.maxRespawnTurns=i,this.ducks=[]}addDuck(){var t=new r(this.getUnocupiedMapPosition(),[1,-1][o(0,1)]);this.ducks.push(t)}killDuck(t){var e=this.ducks.indexOf(t);this.ducks.splice(e,1)}updateDucks(t){this.ducks.forEach(t=>{if("walking"===t.state){let e=t.predictPosition(t.orientation);e>=0&&e<=this.mapLength&&!this.checkCollision(e)&&t.move(t.orientation)}t.update()}),this.ducks.length<this.numDucks&&!(t%this.maxRespawnTurns)&&this.addDuck()}locateDuck(t){return this.ducks.find(e=>e.position===t)}checkCollision(t){return Boolean(this.locateDuck(t))}getUnocupiedMapPosition(){if(this.mapLength<=this.numDucks)throw new Error("Too many ducks!");var t=[...Array(this.mapLength).keys()],e=this.ducks.map(t=>t.position),i=t.filter(t=>!e.includes(t));return i[o(0,i.length-1)]}}(5,100,100),(p=new class{constructor(){this.events={move:[],shoot:[]},document.addEventListener("keydown",this.onKeydown.bind(this))}_dispatchEvent(t,e){this.events[t].forEach(t=>{setTimeout(t.bind(this,e),0)})}addEventListener(t,e){t in this.events&&this.events[t].push(e)}onKeydown(t){"ArrowRight"===t.key&&this._dispatchEvent("move",{direction:1}),"ArrowLeft"===t.key&&this._dispatchEvent("move",{direction:-1})," "===t.key&&this._dispatchEvent("shoot")}}).addEventListener("move",f),p.addEventListener("shoot",g),v()}]);